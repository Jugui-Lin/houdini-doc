{"type": "root", "attrs": {"type": "node", "context": "sop", "internal": "detangle", "icon": "SOP/detangle", "since": "17.0", "verb_since": "16.5", "version": null, "namespace": null}, "body": [{"level": 0, "type": "title", "indent": 0, "text": ["Detangle"], "extent": [107, 120]}, {"type": "summary", "indent": 0, "text": ["Attempts to prevent collisions when deforming geometry."], "extent": [120, 184]}, {"type": "para", "indent": 0, "text": ["Detangle is one part of the Vellum collision pipeline.   It adjusts\npoint positions to try to avoid any collisions, both external and\nself, that occur as a result of a deformation.  It requires a good\nconfiguration for its starting setup, however."], "extent": [184, 433]}, {"type": "para", "indent": 0, "text": ["It can handle line and surface collisions.  All polygons are converted\nto triangles internally, however, so the collision surface may not\nbe what is drawn in the viewport.   Collisions with external objects\nalso allows the use of some types of packed primitives."], "extent": [433, 697]}, {"type": "para", "indent": 0, "text": ["Several physically inspired attributes are also respected if\npresent.  ", {"type": "code", "text": ["mass"]}, " controls how self collision restoration is shared\nbetween points.  ", {"type": "code", "text": ["stopped"]}, " can be used to freeze certain points."], "extent": [697, 891]}, {"type": "para", "indent": 0, "text": ["Two attributes are used to adjust the raw ", {"type": "code", "text": ["pscale"]}, " attribute for\ncollision detection: ", {"type": "code", "text": ["overlap_self"]}, " and ", {"type": "code", "text": ["overlap_external"]}, ".  These\nstore the initial overlap of neighboring points avoiding explosions\nwhen the initial configuration doesn\u2019t respect the full ", {"type": "code", "text": ["pscale"]}, "."], "extent": [891, 1158]}, {"type": "para", "indent": 0, "text": ["The ", {"type": "code", "text": ["collisionignore"]}, " string point attribute is also used to cull\ncollision detection.  This uses the ", {"type": "code", "text": ["collisiongroup"]}, " string point\nattribute to determine if a collision is valid.   If a point\u2019s\n", {"type": "code", "text": ["collisionignore"]}, " pattern matches the other point\u2019s ", {"type": "code", "text": ["collisiongroup"]}, ",\ncollision detection will be skipped.  Triangle and edge detection\nwill be skipped if any of the pairs of points between them would\nbe skipped.   Note ", {"type": "code", "text": ["collisionignore"]}, " is not used from the external\ncollision geometry.  If the external geometry is packed primitives,\nthe ", {"type": "code", "text": ["objname"]}, " string primitive attribute will be used to define\nobjectnames for culling with ", {"type": "code", "text": ["collisionignore"]}, ".  If not, the parent\u2019s\nobjectname, or if there is none, ", {"type": "code", "text": ["external"]}, " is used."], "extent": [1158, 1877]}, {"level": 1, "id": "parameters", "container": true, "type": "parameters_section", "indent": 0, "role": "section", "extent": [1877, 1889], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Previous Position"], "extent": [1889, 1909], "body": [{"type": "para", "indent": 4, "text": ["The incoming ", {"type": "code", "text": ["P"]}, " attribute is considered the new deformed version\n    of the geometry. The Previous Position attribute stores the undeformed\n    version which is assumed to be collision free."], "extent": [1927, 2133]}], "container": true, "attrs": {"id": "prevpos"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Disable Self Attr."], "extent": [2133, 2153], "body": [{"type": "para", "indent": 4, "text": ["This integer attribute will prevent points from engaging in self\n    collisions if it is non-zero."], "extent": [2179, 2292]}], "container": true, "attrs": {"id": "disableselfattr"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Disable External Attr."], "extent": [2292, 2316], "body": [{"type": "para", "indent": 4, "text": ["This integer attribute will prevent points from engaging in external\n    collisions if it is non-zero."], "extent": [2346, 2463]}], "container": true, "attrs": {"id": "disableexternalattr"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Weld Attr."], "extent": [2463, 2475], "body": [{"type": "para", "indent": 4, "text": ["It is often useful to fuse points together logically without\n    actually fusing the point numbers.   The weld attribute is an\n    integer attribute on points giving which point they should weld to.\n    If -1 or their own number, they are unwelded.  The weld number\n    refers to a point number, unless an ", {"type": "code", "text": ["id"]}, " attribute is present, then\n    it refers to an ", {"type": "code", "text": ["id"]}, " number."], "extent": [2494, 2879]}], "container": true, "attrs": {"id": "weldattr"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Default Thickness"], "extent": [2879, 2898], "body": [{"type": "para", "indent": 4, "text": ["Where ", {"type": "code", "text": ["pscale"]}, " is present, the ", {"type": "code", "text": ["pscale"]}, " attribute is used for the point\n    thickness and can vary per point.  This parameter is the default when it is\n    absent, either in the external or self collision geometry."], "extent": [2918, 3147]}], "container": true, "attrs": {"id": "thickness"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Self Collisions"], "extent": [3147, 3164], "body": [{"type": "para", "indent": 4, "text": ["Enable self collision detection."], "extent": [3181, 3228]}], "container": true, "attrs": {"id": "doself"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Collide with Tetrahedral Open Faces"], "extent": [3228, 3265], "body": [{"type": "para", "indent": 4, "text": ["The unshared faces of a tetrahedral mesh will generate collision geometry if this is set.  Sometimes one wishes to use both a triangle shell and a tetrahedral mesh, making this operation redundant."], "extent": [3281, 3493]}], "container": true, "attrs": {"id": "dotet"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Update Overlap Distances"], "extent": [3493, 3519], "body": [{"type": "para", "indent": 4, "text": ["The ", {"type": "code", "text": ["overlap_self"]}, " and ", {"type": "code", "text": ["overlap_external"]}, " will be updated to reflect\n    the current configuration.   They only decrease with this operation,\n    so to initialize set to a large initial value."], "extent": [3543, 3745]}], "container": true, "attrs": {"id": "updateoverlap"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Require Paired Disabling for Automatic"], "extent": [3745, 3785], "body": [{"type": "para", "indent": 4, "text": ["Points that are disabled automatically for self collisions will\n    only be disabled if both points involved in the collision are\n    disabled.  This allows tangled pieces of cloth to pull free (as\n    their mutual collisions are disabled) without other pieces of\n    cloth being free to pass through."], "extent": [3813, 4124]}], "container": true, "attrs": {"id": "pairedautodisable"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Update Disabled Points"], "extent": [4124, 4148], "body": [{"type": "para", "indent": 4, "text": ["Because not all collisions may have been properly handled, this will\n    set the disabled point attributes on those points which are now\n    colliding.  This can be used to avoid trying to enforce them in\n    their now incorrect positions, allowing them to eventually return\n    to the right side of the surface."], "extent": [4172, 4490]}, {"type": "para", "indent": 4, "text": ["When points are set to be disabled their value will be or-ed with\n    ", {"type": "code", "text": ["2"]}, "."], "extent": [4490, 4579]}], "container": true, "attrs": {"id": "updatedisable"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Reset Detangled Points"], "extent": [4579, 4603], "body": [{"type": "para", "indent": 4, "text": ["If a disabled point resolves its colliding relationship and is no longer\n    detangled, reset its disabled status so it will start colliding again."], "extent": [4628, 4781]}, {"type": "para", "indent": 4, "text": ["When points are reset, they are and-ed with not-", {"type": "code", "text": ["2"]}, ".  This ensures if\n    you manually disable a point by setting its value to 1, it won\u2019t be\n    removed by the reset pass, but only those points disabled by the\n    auto-disable will be reset."], "extent": [4781, 5038]}], "container": true, "attrs": {"id": "resetdetangled"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Mark Changed"], "extent": [5038, 5052], "body": [{"type": "para", "indent": 4, "text": ["Any point altered by detangle will have this attribute set to 1."], "extent": [5075, 5149]}], "container": true, "attrs": {"id": "markattr"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Resolve Collisions"], "extent": [5149, 5169], "body": [{"type": "para", "indent": 4, "text": ["Enable adjustment of ", {"type": "code", "text": ["P"]}, " by collisions.  You may not want to do this if\n    updating disabled status, as adjusting positions can cause other points\n    to start to fail that might not be detected."], "extent": [5189, 5400]}], "container": true, "attrs": {"id": "doresolve"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Max Weight"], "extent": [5400, 5412], "body": [{"type": "para", "indent": 4, "text": ["A point may often be moved by multiple collision events at once.  All these\n    adjustments are averaged together.  This is the total weight to apply.\n    Larger values will over-relax and may cause instabilities, but may also\n    lead to faster convergence."], "extent": [5432, 5705]}], "container": true, "attrs": {"id": "maxweight"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Max Displacement"], "extent": [5705, 5723], "body": [{"type": "para", "indent": 4, "text": ["Maximum amount to move a point.  If it has to move farther than this,\n    it will clamp to this displacement and likely be disabled for failing\n    to resolve the collision."], "extent": [5745, 5933]}], "container": true, "attrs": {"id": "maxdisplace"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Resolve All Collisions"], "extent": [5933, 5957], "body": [{"type": "para", "indent": 4, "text": ["An initial gather pass is done across all potential collisions.  These are resolved individually, but averaging the results may not fully resolve the collision.   This will repeat the resolution on colliding pairs until max passes is reached or they are resolved.  Note it does not detect any collisions created in this process."], "extent": [5978, 6321]}], "container": true, "attrs": {"id": "resolveall"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Resolve All Max Passes"], "extent": [6321, 6345], "body": [{"type": "para", "indent": 4, "text": ["Maximum number of passes to resolve the collision list."], "extent": [6369, 6434]}], "container": true, "attrs": {"id": "resolveallmax"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Resolve All Free Edges"], "extent": [6434, 6458], "body": [{"type": "para", "indent": 4, "text": ["Open curves, like hairs, tend to not resolve well in a pair-wise fashion.  So applying the resolve all collisions to them just increasingly tangles them.   This option will enable resolve-all for such open curves if your situation allows it."], "extent": [6488, 6739]}], "container": true, "attrs": {"id": "resolvealledges"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Layer Attr."], "extent": [6739, 6752], "body": [{"type": "para", "indent": 4, "text": ["An integer point attribute providing a layer count for the geometry.   Higher numbers are considered higher layers; ie; will stack on top of the lower numbers."], "extent": [6772, 6946]}], "container": true, "attrs": {"id": "layerattr"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Layer Shock"], "extent": [6946, 6959], "body": [{"type": "para", "indent": 4, "text": ["If two points of different layer numbers collide, their relative mass is adjusted by this layershock factor.   This causes the higher layer to get out of the way of the lower layer.   Note the total layer difference is not used, merely whether it is greater or less.   A value of 2 will cause the lower layer numbers to be effectively twice as heavy as higher numbers for the purpose of collisions."], "extent": [6984, 7392]}], "container": true, "attrs": {"id": "layershock"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["External Friction"], "extent": [7392, 7411], "body": [{"type": "para", "indent": 4, "text": ["A scale factor on the amount of friction effect to apply for collisions with external geometry."], "extent": [7438, 7548]}], "container": true, "attrs": {"id": "externalfriction"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Self Friction"], "extent": [7548, 7563], "body": [{"type": "para", "indent": 4, "text": ["A scale factor on the amount of friction effect to apply for collisions with self geometry."], "extent": [7586, 7692]}], "container": true, "attrs": {"id": "selffriction"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Static Threshold"], "extent": [7692, 7710], "body": [{"type": "para", "indent": 4, "text": ["A threshold at which to apply full friction.  When the ratio of the tangential velocity and the normal impulse is less than this, the tangential velocity will be fully eliminated through friction.  This is roughly tan() of the slope angle that will allow sliding under gravity."], "extent": [7741, 8028]}], "container": true, "attrs": {"id": "static_threshold"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Scale Kinetic"], "extent": [8028, 8043], "body": [{"type": "para", "indent": 4, "text": ["If the static threshold fails, this controls what percentage the tangential velocity will be reduced in the dynamic friction case."], "extent": [8071, 8207]}], "container": true, "attrs": {"id": "kinetic_scale"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Assume Constant Collision Topology"], "extent": [8207, 8243], "body": [{"type": "para", "indent": 4, "text": ["Most cases of constant topology (ie, polygons are wired to the same point)\n    will be automatically detected.  However, this will avoid checking the\n    topology at all and assume the points are wired up the same way they\n    were when first encountered."], "extent": [8283, 8548]}], "container": true, "attrs": {"id": "constantcollisiontopology"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Shared Cache Name"], "extent": [8548, 8567], "body": [{"type": "para", "indent": 4, "text": ["A global cache shared between multiple detangle SOPs.  This allows them\n    to share the same acceleration structures and topology.  Note that they\n    should genuinely be referring to the same geometry - only one version\n    is saved per cache name, so sharing unnecessarily will just needlessly\n    flush the cache."], "extent": [8593, 8920]}], "container": true, "attrs": {"id": "sharedcache"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Cache Reset Key"], "extent": [8920, 8937], "body": [{"type": "para", "indent": 4, "text": ["A collision tree can often be re-used for different point positions if they have not changed over much.  If this parameter evaluates to the same value, the tree will only be reset if the topology changed.  This will not result in missed collisions, only possibly in slow down as the tree stops representing the geometry.   Negative values will always reset the tree."], "extent": [8960, 9336]}], "container": true, "attrs": {"id": "resetkey"}, "role": "item"}], "container": true, "role": "item_group"}], "text": "Parameters"}, {"level": 1, "id": "related", "container": true, "type": "related_section", "indent": 0, "role": "section", "extent": [9336, 9345], "body": [{"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/sop/vellumsolver", "type": "link", "text": "", "fullpath": "/nodes/sop/vellumsolver"}], "extent": [9345, 9372]}], "container": true}], "text": "Related"}], "title": ["Detangle"], "summary": ["Attempts to prevent collisions when deforming geometry."]}